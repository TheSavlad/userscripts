window.ozon.orderlist=function(){const o=window.ozon,{$:e,$$:t,error:n,log:r,dom:s}=o,a=0,i=4,d=5,c=0,l=1,p=2,f=3,u="отменён,в сборке,передаётся,в пути,ожидает,получен".split(","),h="январ,феврал,март,апрел,ма,июн,июл,август,сентябр,октябр,ноябр,декабр".split(","),m={[a]:"🛑 Отменён",1:"⌛ В сборке",2:"📦 Передаётся",3:"🚚 В пути",[i]:"⚠️ Ожидает",[d]:"✅ Получен"},x=[{"body #layoutPage>div>[data-widget=wallpaper]":{"margin-top":"179px"},".ozon-helper-orders":{left:"0px",right:"0px","background-color":"#FFFFFF","border-bottom":"1px solid #E0E6EF",display:"flex","overflow-x":"scroll",gap:"5px",padding:"5px"},".ozon-helper-orders.fixed":{position:"fixed",top:"63px"},".ozon-helper-orders.absolute":{position:"absolute",top:"132px"},".ozon-order":{display:"flex","flex-direction":"column","align-items":"center",border:"1px solid #E0E6EF",padding:"3px"},".ozon-order-ready":{animation:"1s infinite alternate ozon-blink","background-color":"currentcolor","box-shadow":"0px 0px 10px currentcolor"},".ozon-order-ready .ozon-item-state-name":{border:"none",color:"black"},".ozon-order-items":{display:"flex",gap:"3px"},".ozon-item":{display:"flex","flex-direction":"column","align-items":"center",gap:"3px"},".ozon-item-state-name":{"border-bottom":"1px solid #E0E6EF","padding-bottom":"3px"},".ozon-order a":{"min-width":"100px","max-width":"100px","min-height":"100px","max-height":"100px",display:"flex","justify-content":"center","align-items":"center"},".ozon-order a>img":{"max-width":"100%","max-height":"100%"},".ozon-order-divider":{"min-width":"5px","min-height":"100%","background-color":"#E0E6EF"}},"@keyframes ozon-blink {","    0% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   10% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   80% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","  100% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","}"];function g(o,t){if("A"!==o.tagName)return n("element not <a>:",o);const r=o,s={href:"",src:"",state:t.state,stateName:""};if(s.stateName=m[t.state],s.href=r.href,!s.href)return n("no href for",r);const a=e(r,"img");return a?(s.src=a.src,s.src?s:n("no src for",a)):n("no img for",r)}function b(s){const a={day:-1,month:-1,date:"",state:-1,items:[]};if(function(t,r){const s=e(t,".e5u_14");if(!s)return n("state element not found for",t);const a=s.innerText.toLowerCase(),i=o.findMany(a,u);return i<0?n("unknown state in",s):(r.state=i,!0)}(s,a)&&function(t,r){const s=r.state===i?".u4e_14":".ew4_14",a=e(t,s);if(!a)return n("date element not found for",t);const d=/(\d+) ([а-яё]+)/.exec(a.innerText.trim());if(!d)return n("invalid date string in",a);const[c,l,p]=d;return r.date=c,r.day=+l,isNaN(r.day)?n("invalid day in",a):(r.month=o.findMany(p.toLowerCase(),h),r.month<0?n("unknown month in",a):(r.state===i&&(r.date=`до ${r.date}`),!0))}(s,a)){for(const o of t(s,".w5e_14")){const e=g(o,a);e&&a.items.push(e)}return r("order:",a),a}}function y(o){o.appendChild(s("div",{className:"ozon-order-divider"}))}function w(o,e,t){e.sort(t("index")).forEach((e=>function(o,e){const t=["ozon-order"];o.state===f&&t.push("ozon-order-ready");const n=s("div",{className:t.join(" ")},s("div",{className:"ozon-order-items"},o.orders.map((o=>s("div",{className:"ozon-item"},s("a",{href:o.href},s("img",{loading:"lazy",fetchPriority:"low",src:o.src})),s("div",{className:"ozon-item-state"},s("div",{className:"ozon-item-state-name"},o.stateName)))))),s("div",{className:"ozon-order-date"},o.str));e.appendChild(n)}(e,o)))}function v(e,s){r("updating orders");const u=function(o){const e=[];for(const n of t(o,"[data-widget=orderList] .w1e_14")){const o=b(n);o&&e.push(o)}return e}(e);r(u.length,"orders found");const h=function(e){const t={};for(const o of e)t[o.date]||(t[o.date]={day:o.day,mon:o.month,str:o.date,state:-1,index:+[1,String(o.month).padStart(2,"0"),String(o.day).padStart(2,"0")].join(""),orders:[]}),t[o.date].orders.push(...o.items);for(const o of Object.values(t))o.state=p,o.orders.some((o=>o.state===i))?o.state=f:o.orders.every((o=>o.state===d))?o.state=l:o.orders.every((o=>o.state===a))&&(o.state=c);return Object.values(t).sort(o.desc("state"))}(u);r("groups:",h);const[m,x,g]=function(o){const e=[],t=[],r=[];for(const s of o){if(s.state===c)continue;const o={[l]:r,[p]:t,[f]:e}[s.state];o?o.push(s):n("unknown group category for:",s)}return[r,t,e]}(h);for(;s.firstChild;)s.firstChild.remove();const v=g.length,z=x.length,k=m.length,E=v+z,N=z+k;w(s,g,o.asc),v>0&&N>0&&y(s),w(s,x,o.asc),E>0&&k>0&&y(s),w(s,m,o.desc)}function z(o,e){r("updating header");const t=o.classList.contains("d4i_9");r("header is sticky =",t),e.classList.toggle("fixed",t),e.classList.toggle("absolute",!t)}return function(){o.css(...x);const t=e("#stickyHeader");if(!t)return n("sticky header not found");r("stickyHeader =",t);const a=e("[data-widget=paginator]>div");if(!a)return n("paginator not found");r("paginator =",a);const i=s("div",{className:"ozon-helper-orders"});i.addEventListener("wheel",(o=>{i.scrollBy({left:o.deltaY,behavior:"smooth"}),o.preventDefault()})),document.body.appendChild(i),r("container created:",i),o.observe(t,{attributes:!0},(()=>z(t,i))),r("observing header"),z(t,i),o.observe(a,{childList:!0},(()=>v(a,i))),r("observing paginator"),v(a,i)}}();
