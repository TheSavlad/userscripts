(()=>{const e=function(){const e=window.ozon,{$:o,$$:t,error:r,log:n,dom:i}=e,a=0,s=4,d=5,c=0,l=1,f=2,p=3,h="отменён,в сборке,передаётся,в пути,ожидает,получен".split(","),m="январ,феврал,март,апрел,ма,июн,июл,август,сентябр,октябр,ноябр,декабр".split(","),u={[a]:"🛑 Отменён",1:"⌛ В сборке",2:"📦 Передаётся",3:"🚚 В пути",[s]:"⚠️ Ожидает",[d]:"✅ Получен"},g=[{"body #layoutPage>div>[data-widget=wallpaper]":{"margin-top":"179px"},".ozon-helper-orders":{left:"0px",right:"0px","background-color":"#FFFFFF","border-bottom":"1px solid #E0E6EF",display:"flex","overflow-x":"scroll",gap:"5px",padding:"5px"},".ozon-helper-orders.fixed":{position:"fixed",top:"63px"},".ozon-helper-orders.absolute":{position:"absolute",top:"132px"},".ozon-order":{display:"flex","flex-direction":"column","align-items":"center",border:"1px solid #E0E6EF",padding:"3px"},".ozon-order-ready":{animation:"1s infinite alternate ozon-blink","background-color":"currentcolor","box-shadow":"0px 0px 10px currentcolor"},".ozon-order-ready .ozon-item-state-name":{border:"none",color:"black"},".ozon-order-items":{display:"flex",gap:"3px"},".ozon-item":{display:"flex","flex-direction":"column","align-items":"center",gap:"3px"},".ozon-item-state-name":{"border-bottom":"1px solid #E0E6EF","padding-bottom":"3px"},".ozon-order a":{"min-width":"100px","max-width":"100px","min-height":"100px","max-height":"100px",display:"flex","justify-content":"center","align-items":"center"},".ozon-order a>img":{"max-width":"100%","max-height":"100%"},".ozon-order-divider":{"min-width":"5px","min-height":"100%","background-color":"#E0E6EF"}},"@keyframes ozon-blink {","    0% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   10% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   80% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","  100% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","}"],x={header:"",paginator:"",order:"",orderState:""};function w(e){return Object.values(e?.classList||[]).map((e=>`.${e}`)).join("")}function b(e,t){if(!e)return r("invalid order item element");if("A"!==e.tagName)return r("element not <a>:",e);const n=e,i={href:"",src:"",state:t.state,stateName:""};if(i.stateName=u[t.state],i.href=n.href,!i.href)return r("no href for",n);const a=o(n,"img");return a?(i.src=a.src,i.src?i:r("no src for",a)):r("no img for",n)}function v(i){const a={day:0,month:0,date:"?",state:-1,items:[]};if(function(t,n){const i=o(t,x.orderState);if(!i)return r("state element not found for",t);const a=i.innerText.toLowerCase(),s=e.findMany(a,h);return s<0?r("unknown state in",i):(n.state=s,!0)}(i,a)&&function(t,n){let i=null;if(n.state===s){const e=o(t,"svg");e&&(i=e.previousElementSibling)}if(i||(i=o(t,"p")),!i)return r("date element not found for",t);const a=/(\d+) ([а-яё]+)/.exec(i.innerText.trim());if(!a)return!!i.innerText.includes("уточн")||r("invalid date string in",i);const[d,c,l]=a;return n.date=d,n.day=+c,isNaN(n.day)?r("invalid day in",i):(n.month=e.findMany(l.toLowerCase(),m),n.month<0?r("unknown month in",i):(n.state===s&&(n.date=`до ${n.date}`),!0))}(i,a)){for(const e of t(i,"a>img")){const o=b(e.parentElement,a);o&&a.items.push(o)}return n("order:",a),a}}function y(e){e.appendChild(i("div",{className:"ozon-order-divider"}))}function z(e,o,t){o.sort(t("index")).forEach((o=>function(e,o){const t=["ozon-order"];e.state===p&&t.push("ozon-order-ready");const r=i("div",{className:t.join(" ")},i("div",{className:"ozon-order-items"},e.orders.map((e=>i("div",{className:"ozon-item"},i("a",{href:e.href},i("img",{loading:"lazy",fetchPriority:"low",src:e.src})),i("div",{className:"ozon-item-state"},i("div",{className:"ozon-item-state-name"},e.stateName)))))),i("div",{className:"ozon-order-date"},e.str));o.appendChild(r)}(o,e)))}function E(o,i){n("updating orders");const h=function(e){const o=[];for(const r of t(e,x.order)){const e=v(r);e&&o.push(e)}return o}(o);n(h.length,"orders found");const m=function(o){const t={};for(const e of o)t[e.date]||(t[e.date]={day:e.day,mon:e.month,str:e.date,state:-1,index:+[1,String(e.month).padStart(2,"0"),String(e.day).padStart(2,"0")].join(""),orders:[]}),t[e.date].orders.push(...e.items);for(const e of Object.values(t))e.state=f,e.orders.some((e=>e.state===s))?e.state=p:e.orders.every((e=>e.state===d))?e.state=l:e.orders.every((e=>e.state===a))&&(e.state=c);return Object.values(t).sort(e.desc("state"))}(h);n("groups:",m);const[u,g,w]=function(e){const o=[],t=[],n=[];for(const i of e){if(i.state===c)continue;const e={[l]:n,[f]:t,[p]:o}[i.state];e?e.push(i):r("unknown group category for:",i)}return[n,t,o]}(m);for(;i.firstChild;)i.firstChild.remove();const b=w.length,E=g.length,k=u.length,N=b+E,F=E+k;z(i,w,e.asc),b>0&&F>0&&y(i),z(i,g,e.asc),N>0&&k>0&&y(i),z(i,u,e.desc)}function k(e,o){n("updating header");const t=e.classList.length>1;n("header is sticky =",t),o.classList.toggle("fixed",t),o.classList.toggle("absolute",!t)}return function(){e.css(...g),function(){x.header='[data-widget="header"]>div:first-child',x.paginator='[data-widget="paginator"]>div';const e=o("[data-widget=orderList]");if(!e)throw new Error("order list not found");const t=o(e,"img");if(!t)throw new Error("order image not found");const r=Array.from(e.firstElementChild?.children??[]);let i=t.parentElement;for(;i!==e;){if(!i)throw new Error("no parent element");if(r.includes(i)){x.order=w(i.firstElementChild);break}i=i.parentElement}if(!x.order)throw new Error("order selector not found");x.order=`[data-widget="orderList"] ${x.order}`;const a=o(e,x.order);if(!a)throw new Error("order selector failed");const s=o(a,"div>span:first-child:last-child");if(!s)throw new Error("order state selector failed");x.orderState=w(s),n("selectors =",x)}();const t=o(x.header);if(!t)return r("sticky header not found");n("stickyHeader =",t);const a=o("[data-widget=paginator]>div");if(!a)return r("paginator not found");n("paginator =",a);const s=i("div",{className:"ozon-helper-orders"});s.addEventListener("wheel",(e=>{s.scrollBy({left:e.deltaY,behavior:"smooth"}),e.preventDefault()})),document.body.appendChild(s),n("container created:",s),e.observe(t,{attributes:!0},(()=>k(t,s))),n("observing header"),k(t,s),e.observe(a,{childList:!0},(()=>E(a,s))),n("observing paginator"),E(a,s)}}();window.ozon.orderlist=e})();
