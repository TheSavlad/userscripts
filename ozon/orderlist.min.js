(()=>{const e=function(){const e=window.ozon,{$:t,$$:o,error:r,log:n,dom:a}=e,i=0,s=4,d=5,l=0,c=1,f=2,p=3,h="отменён,в сборке,передаётся,в пути,ожидает,получен,в службе".split(","),u="январ,феврал,март,апрел,ма,июн,июл,август,сентябр,октябр,ноябр,декабр".split(","),m={[i]:"🛑 Отменён",1:"⌛ В сборке",2:"📦 Передаётся",6:"📦 В доставке",3:"🚚 В пути",[s]:"⚠️ Ожидает",[d]:"✅ Получен"},g=[{"body #layoutPage>div>[data-widget=wallpaper]:last-child":{"margin-top":"179px"},"body #layoutPage>div>[data-widget=wallpaper]:first-child>div>header":{"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px"},".ozon-helper-orders":{left:"0px",right:"0px","background-color":"#FFFFFF","border-bottom":"1px solid #E0E6EF",display:"flex","overflow-x":"scroll",gap:"5px",padding:"5px"},".ozon-helper-orders.fixed":{position:"fixed",top:"63px"},".ozon-helper-orders.absolute":{position:"absolute",top:"132px"},".ozon-order":{display:"flex","flex-direction":"column","align-items":"center",border:"1px solid #E0E6EF",padding:"3px"},".ozon-order-ready":{animation:"1s infinite alternate ozon-blink","background-color":"currentcolor","box-shadow":"0px 0px 10px currentcolor"},".ozon-order-ready .ozon-item-state-name":{border:"none",color:"black"},".ozon-order-items":{display:"flex",gap:"3px"},".ozon-item":{display:"flex","flex-direction":"column","align-items":"center",gap:"3px"},".ozon-item-state-name":{"border-bottom":"1px solid #E0E6EF","padding-bottom":"3px"},".ozon-order a":{"min-width":"100px","max-width":"100px","min-height":"100px","max-height":"100px",display:"flex","justify-content":"center","align-items":"center"},".ozon-order a>img":{"max-width":"100%","max-height":"100%"},".ozon-order-divider":{"min-width":"5px","min-height":"100%","background-color":"#E0E6EF"}},"@keyframes ozon-blink {","    0% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   10% { background-color: hsl(45, 80%, 50%); box-shadow: 0px 0px 10px hsl(45, 80%, 40%); }","   80% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","  100% { background-color: hsl(45, 80%, 80%); box-shadow: 0px 0px  2px hsl(45, 80%, 40%); }","}"],x={header:"",paginator:"",order:"",orderState:""};function b(e){return Object.values(e?.classList||[]).map((e=>`.${e}`)).join("")}function w(e,o){if(!e)return r("invalid order item element");if("A"!==e.tagName)return r("element not <a>:",e);const n=e,a={href:"",src:"",state:o.state,stateName:""};if(a.stateName=m[o.state],a.href=n.href,!a.href)return r("no href for",n);const i=t(n,"img");return i?(a.src=i.src,a.src?a:r("no src for",i)):r("no img for",n)}function v(a){const i={day:0,month:0,date:"?",state:-1,items:[]};if(function(o,n){const a=t(o,x.orderState);if(!a)return r("state element not found for",o);const i=a.innerText.toLowerCase(),s=e.findMany(i,h);return s<0?r("unknown state in",a):(n.state=s,!0)}(a,i)&&function(o,n){let a=null;if(n.state===s){const e=t(o,"svg");e&&(a=e.previousElementSibling)}if(a||(a=t(o,"p")),!a)return r("date element not found for",o);const i=/(\d+) ([а-яё]+)/.exec(a.innerText.trim());if(!i)return!!a.innerText.includes("уточн")||r("invalid date string in",a);const[d,l,c]=i;return n.date=d,n.day=+l,isNaN(n.day)?r("invalid day in",a):(n.month=e.findMany(c.toLowerCase(),u),n.month<0?r("unknown month in",a):(n.state===s&&(n.date=`до ${n.date}`),!0))}(a,i)){for(const e of o(a,"a>img")){const t=w(e.parentElement,i);t&&i.items.push(t)}return n("order:",i),i}}function y(e){e.appendChild(a("div",{className:"ozon-order-divider"}))}function z(e,t,o){t.sort(o("index")).forEach((t=>function(e,t){const o=["ozon-order"];e.state===p&&o.push("ozon-order-ready");const r=a("div",{className:o.join(" ")},a("div",{className:"ozon-order-items"},e.orders.map((e=>a("div",{className:"ozon-item"},a("a",{href:e.href},a("img",{loading:"lazy",fetchPriority:"low",src:e.src})),a("div",{className:"ozon-item-state"},a("div",{className:"ozon-item-state-name"},e.stateName)))))),a("div",{className:"ozon-order-date"},e.str));r.dataset.state=e.state,t.appendChild(r)}(t,e)))}function E(t,a){n("updating orders");const h=function(e){const t=[];for(const r of o(e,x.order)){const e=v(r);e&&t.push(e)}return t}(t);n(h.length,"orders found");const u=function(t){const o={};for(const e of t){const t=[];for(const o of e.items)o.state!==i&&t.push(o);0!==t.length&&(o[e.date]||(o[e.date]={day:e.day,mon:e.month,str:e.date,state:-1,index:+[1,String(e.month).padStart(2,"0"),String(e.day).padStart(2,"0")].join(""),orders:[]}),o[e.date].orders.push(...t))}for(const e of Object.values(o))e.state=f,e.orders.some((e=>e.state===s))?e.state=p:e.orders.every((e=>e.state===d))?e.state=c:e.orders.every((e=>e.state===i))&&(e.state=l);return Object.values(o).sort(e.desc("state"))}(h);n("groups:",u);const[m,g,b]=function(e){const t=[],o=[],n=[];for(const a of e){if(a.state===l)continue;const e={[c]:n,[f]:o,[p]:t}[a.state];e?e.push(a):r("unknown group category for:",a)}return[n,o,t]}(u);for(;a.firstChild;)a.firstChild.remove();const w=b.length,E=g.length,k=m.length,N=w+E,F=E+k;z(a,b,e.asc),w>0&&F>0&&y(a),z(a,g,e.asc),N>0&&k>0&&y(a),z(a,m,e.desc)}function k(e,t){n("updating header");const o=e.classList.length>1;n("header is sticky =",o),t.classList.toggle("fixed",o),t.classList.toggle("absolute",!o)}return function(){e.css(...g),function(){x.header='[data-widget="header"]>div:first-child',x.paginator='[data-widget="paginator"]>div';const e=t("[data-widget=orderList]");if(!e)throw new Error("order list not found");const o=t(e,"img");if(!o)throw new Error("order image not found");const r=Array.from(e.firstElementChild?.children??[]);let a=o.parentElement;for(;a!==e;){if(!a)throw new Error("no parent element");if(r.includes(a)){x.order=b(a.firstElementChild);break}a=a.parentElement}if(!x.order)throw new Error("order selector not found");x.order=`[data-widget="orderList"] ${x.order}`;const i=t(e,x.order);if(!i)throw new Error("order selector failed");let s=t(i,"div>span+svg")?.previousElementSibling;if(!s&&(s=t(i,"div>span:first-child:last-child"),!s))throw new Error("order state selector failed");x.orderState=b(s),n("selectors =",x)}();const o=t(x.header);if(!o)return r("sticky header not found");n("stickyHeader =",o);const i=t("[data-widget=paginator]>div");if(!i)return r("paginator not found");n("paginator =",i);const s=a("div",{className:"ozon-helper-orders"});s.addEventListener("wheel",(e=>{s.scrollBy({left:e.deltaY,behavior:"smooth"}),e.preventDefault()})),document.body.appendChild(s),n("container created:",s),e.observe(o,{attributes:!0},(()=>k(o,s))),n("observing header"),k(o,s),e.observe(i,{childList:!0},(()=>E(i,s))),n("observing paginator"),E(i,s)}}();window.ozon.orderlist=e})();
